From 3651dd25ea23d7052d9f91672a3d586887e6277e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Nikola=20Forr=C3=B3?= <nforro@redhat.com>
Date: Fri, 6 Oct 2017 12:15:15 +0200
Subject: [PATCH] Add missing xmp_init() to nautilus-desktop main()

Also add missing xmp_terminate().
---
 nautilus-desktop/main-desktop.c | 11 +++++++++++
 src/nautilus-main.c             |  4 ++++
 2 files changed, 15 insertions(+)

diff --git a/nautilus-desktop/main-desktop.c b/nautilus-desktop/main-desktop.c
index 57abeae..c394763 100644
--- a/nautilus-desktop/main-desktop.c
+++ b/nautilus-desktop/main-desktop.c
@@ -13,6 +13,10 @@
 #include <string.h>
 #include <unistd.h>
 
+#ifdef HAVE_EXEMPI
+#include <exempi/xmp.h>
+#endif
+
 int
 main (int   argc,
       char *argv[])
@@ -29,6 +33,9 @@ main (int   argc,
 
     gdk_set_allowed_backends ("x11");
 
+#ifdef HAVE_EXEMPI
+    xmp_init ();
+#endif
     nautilus_register_resource ();
     application = nautilus_desktop_application_new ();
 
@@ -37,5 +44,9 @@ main (int   argc,
 
     g_object_unref (application);
 
+#ifdef HAVE_EXEMPI
+    xmp_terminate ();
+#endif
+
     return retval;
 }
diff --git a/src/nautilus-main.c b/src/nautilus-main.c
index 1471e86..88d7ed2 100644
--- a/src/nautilus-main.c
+++ b/src/nautilus-main.c
@@ -104,6 +104,10 @@ main (int   argc,
 
     g_object_unref (application);
 
+#ifdef HAVE_EXEMPI
+    xmp_terminate ();
+#endif
+
     eel_debug_shut_down ();
 
     return retval;
-- 
2.13.6

